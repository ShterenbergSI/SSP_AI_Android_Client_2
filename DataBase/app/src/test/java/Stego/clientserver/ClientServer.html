<!-- saved from url=(0022)http://internet.e-mail -->
<html>
<!--  Created with the CoffeeCup HTML Editor  -->
<!--        http://www.coffeecup.com/         -->
<!--      Brewed on 12.11.2002 18:51:48       -->
<head>
  <title></title>
</head>
<body>
<!-- начало -->
<b>Создаем клиент-сервер на сокетах</b><br>(С) Алексей Синельников, 2002 год.<br>
<br>
<b>Содержание</b><br>
<li type="square">Что такое сокеты?
<li type="square">Создаем сервер
<li type="square">Создаем клиент
<li type="square">Приложения
<br>
<br>
<i>Что такое сокеты?</i><br>
	Для начала давайте определим что такое сервер и клиент.  Итак, сервер - это специальная программа, обычно запущенная на отдельном компьютере (хосте, от слова host(eng.) - хозяин), и выполняющая некий круг задач. Клиент, в свою очередь - программа, которая запрашивает сервер выполнить то или иное действие (задачу) и вернуть полученные данные клиенту.  На хосте для работы сервера обычно выделяется порт (port). К этому порту и должен будет обращаться клиент.  Клиент для связи с портом хоста, который соединен в свою очередь с нужным сервером (программой), создает сокет.<br>
	В целом алгоритм работы системы клиент-сервер выглядит следующим образом:<br>
1.	Сервер подключается к порту на хосте и ждет соединения с клиентом;<br>
2.	Клиент создает сокет и пытается соединить его с портом на хосте;<br>
3.	Если создание сокета прошло успешно, то сервер переходит в режим ожидания команд от клиента;<br>
4.	Клиент формирует команду и передает ее серверу, переходит в режим ожидания ответа;<br>
5.	Сервер принимает команду, выполнеят ее и пересылает ответ клиенту.<br>
6.	и т.д.<br>
Теперь попробуем создать сервер и клиент.<br>
<br>
<i>Создаем сервер</i><br>
	Для создания сокетов и управления ими в Java есть специальные классы java.net.Socket и java.net.ServerSocket. Первый для клиента, второй для сервера. Так же нам будут необходимы два класса из пакета java.io.*: BufferedReader и PrintWriter для чтения/записи в сокет (думаю, что читатель уже знаком с этими классами).<br>
	Для начала подключимся к порту хоста. Сделать это можно с помощью конструктора класса ServerSocket. Обратите внимание, что конструктор выбрасывает исключение типа IOException, т.е. нам понадобится блок try - catch:<br>
<br>
<pre><font color="0000ff">
    ServerSocket servers;
    try {
      servers = new ServerSocket(4444);
    } catch (IOException e) {
      System.out.println("Couldn't listen to port 4444");
      System.exit(-1);
    }
</font></pre><br>
	После успешного подключения к порту сервер должен ждать подключения от клиента. Сделать это можно так:<br>

<pre><font color="0000ff">
    Socket fromclient;
    try {
      System.out.print("Waiting for a client...");
      fromclient= servers.accept();
      System.out.println("Client connected");
    } catch (IOException e) {
      System.out.println("Can't accept");
      System.exit(-1);
    }
</font></pre><br>
	Рассмотрим этот блок подробнее. Метод servers.accept() позволяет серверу следить за портом, или иначе говоря ждать подключения клиента.  Как только клиент подключается - сокет для клиента сразу же создается. В противном случае выбрасывается исключение IOException.<br>
	Как только клиент подключился к серверу, сервер должен создать потоки ввода и вывода для связи с ним. Это можно сделать следующим образом:<br>
<br>
<pre><font color="0000ff">
	BufferedReader in;
	PrintWriter    out;
	in=new BufferedReader(new InputStreamReader(fromclient.getInputStream())); 
	out = new PrintWriter(fromclient.getOutputStream(),true);
</font></pre><br>
	И далее можно просто считывать данные из потока in и записывать данные в out. Исходный код сервера  
	<a href="Server.java">здесь...</a>
<br><br>

<i>Создаем клиент</i><br>
	Для создания клиента достаточно класса Socket и двух классов для ввода/вывода (см. Создаем сервер). Также необходимо знать имя компьютера (хоста), на котором запущен сервер и номер порта.<br>
	Конструктор сокета имеет два параметра: имя хоста и номер порта. Опять таки, конструктор выбрасывает исключение типа IOException.<br>
<pre><font color="0000ff">
      Socket fromserver = null;
      fromserver = new Socket("localhost",4444);
</font></pre><br>
	Далее аналогичным образом, как для сервера, создаем потоки ввода вывода. И можно записывать/считывать данные.<br>
	Исходный код клиента <a href="client.java">здесь....</a><br>
<br>

<i>Приложения</i><br>
 	Клиент-сервер на примере Echo server (Эхо сервер). Клиент получает обратно строку переданную серверу.<br>
<li type="square">Исходный код для клиента
<li type="square">Исходный код для сервера
<br><br>
<b>Несколько замечаний по кодам:</b><br>
Обратите внимание на конструкцию методов main :<br>

<pre><font color="0000ff">
       public static void main(String[] args) throws IOException {}
</pre></font>
throws IOException позволит не использовать блоки try-catch для ловки исключения IOException в самом методе, что достаточно удобно.<br>
В клиентской части используется параметр командной строки для указания имени хоста. Например, если Вы запускаете сервер и клиент на одном компьютере, то клиент надо запускать так:<br>

<pre><font color="0000ff">
       java client localhost
</pre></font>



<!-- конец -->
</body>
</html>

